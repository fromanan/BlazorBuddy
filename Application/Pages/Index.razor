@inject ISessionService SessionService
@inject ILayoutService LayoutService
@inject IContextMenuService ContextMenuService
@inject IDatabaseService DatabaseService
@inject SessionContext SessionContext

@page "/"

<PageTitle>Blazor Buddy</PageTitle>

@SessionService.RenderSelectedSession()

@code
{
    protected override void OnInitialized()
    {
        SubscribeListeners();
    }

    protected override async Task OnInitializedAsync()
    {
        await SessionContext.Initialize();
        await DatabaseService.Initialize();
        await SessionService.Initialize(ContextMenuService, DatabaseService);
    }

    private void SubscribeListeners()
    {
        SessionService.SubscribeToUpdate(UpdateView);
        LayoutService.SubscribeToUpdate(UpdateView);
    }

    private async void UpdateView()
    {
        await InvokeAsync(StateHasChanged);
    }
}