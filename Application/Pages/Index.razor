@inject ISessionService SessionService
@inject ILayoutService LayoutService
@inject IContextMenuService ContextMenuService
@inject IDatabaseService DatabaseService
@inject SessionContext SessionContext

@page "/"

<PageTitle>Blazor Buddy</PageTitle>

@SessionService.RenderSelectedSession()

@code
{
    protected override void OnInitialized()
    {
        SubscribeListeners();
    }

    protected override async Task OnInitializedAsync()
    {
        await SessionContext.Initialize();
        await DatabaseService.Initialize();
        
        SessionService.Initialize(ContextMenuService, DatabaseService);
    }

    private void SubscribeListeners()
    {
        SessionService.SelectionChanged     += UpdateView;
        SessionService.SessionsUpdated      += UpdateView;
        LayoutService.LayoutStyleChanged    += UpdateView;
        LayoutService.SortOrderChanged      += UpdateView;
    }

    private async void UpdateView()
    {
        await InvokeAsync(StateHasChanged);
    }

    private async void UpdateView<T>(T obj)
    {
        await InvokeAsync(StateHasChanged);
    }
}